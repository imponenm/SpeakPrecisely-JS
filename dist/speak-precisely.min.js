!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SpeakPrecisely={})}(this,(function(e){"use strict";var t;e.TranscriptionEvents=void 0,(t=e.TranscriptionEvents||(e.TranscriptionEvents={})).Connected="connected",t.Disconnected="disconnected",t.Error="error",t.Transcript="transcript",t.MaxConnectionsReached="maxConnectionsReached";e.SpeakPrecisely=class{constructor(t){this.publicKey=t,this.ws=null,this.mediaRecorder=null,this.stream=null,this.eventHandlers=new Map,this.baseUrl="wss://dg.speakprecisely.com/subtitles",Object.values(e.TranscriptionEvents).forEach((e=>{this.eventHandlers.set(e,new Set)}))}on(e,t){const s=this.eventHandlers.get(e);s&&s.add(t)}off(e,t){const s=this.eventHandlers.get(e);s&&s.delete(t)}emit(e,...t){const s=this.eventHandlers.get(e);s&&s.forEach((e=>e(...t)))}async start({spokenLanguage:t,targetLanguages:s}){try{this.stream=await navigator.mediaDevices.getUserMedia({audio:!0});const i=new URLSearchParams({spokenLanguage:t,targetLanguages:s.join(","),publicKey:this.publicKey});this.ws=new WebSocket(`${this.baseUrl}?${i}`),this.ws.onopen=()=>{this.setupMediaRecorder(),this.emit(e.TranscriptionEvents.Connected)},this.ws.onclose=()=>{this.emit(e.TranscriptionEvents.Disconnected)},this.ws.onerror=t=>{this.emit(e.TranscriptionEvents.Error,t)},this.ws.onmessage=t=>{const s=JSON.parse(t.data);if("MAX_CONNECTIONS_REACHED"===s.type)return this.emit(e.TranscriptionEvents.MaxConnectionsReached),void this.stop();"Results"===s.type&&this.emit(e.TranscriptionEvents.Transcript,s)}}catch(t){throw this.emit(e.TranscriptionEvents.Error,t),t}}setupMediaRecorder(){this.stream&&(this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.ondataavailable=e=>{var t;e.data.size>0&&(null===(t=this.ws)||void 0===t?void 0:t.readyState)===WebSocket.OPEN&&this.ws.send(e.data)},this.mediaRecorder.start(250))}stop(){var e,t,s,i;"inactive"!==(null===(e=this.mediaRecorder)||void 0===e?void 0:e.state)&&(null===(t=this.mediaRecorder)||void 0===t||t.stop()),null===(s=this.stream)||void 0===s||s.getTracks().forEach((e=>e.stop())),(null===(i=this.ws)||void 0===i?void 0:i.readyState)===WebSocket.OPEN&&this.ws.close(),this.mediaRecorder=null,this.stream=null,this.ws=null}isConnected(){var e;return(null===(e=this.ws)||void 0===e?void 0:e.readyState)===WebSocket.OPEN}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=speak-precisely.min.js.map
